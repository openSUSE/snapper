<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>snapper</title>
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.0" />
  </head>
  <body>
    <div class="refentry">
      <a id="snapper8"></a>
      <div class="titlepage"></div>
      <div class="refnamediv">
        <h2>Name</h2>
        <p>snapper â€” Command-line program for filesystem snapshot management</p>
      </div>
      <div class="refsynopsisdiv">
        <a id="synopsis"></a>
        <h2>Synopsis</h2>
        <div class="cmdsynopsis">
          <p><code class="command">snapper</code>  [<em class="replaceable"><code>--global-opts</code></em>]  <em class="replaceable"><code>command</code></em>  [<em class="replaceable"><code>--command-opts</code></em>] [<em class="replaceable"><code>command-arguments</code></em>]</p>
        </div>
        <div class="cmdsynopsis">
          <p><code class="command">snapper</code>  {--help}</p>
        </div>
      </div>
      <div class="refsect1">
        <a id="description"></a>
        <h2>DESCRIPTION</h2>
        <p>Snapper is a command-line program for filesystem snapshot management. It can
    create, delete and compare snapshots and undo changes done between snapshots.</p>
        <p>Snapper never modifies the content of snapshots. Thus snapper creates
    read-only snapshots if supported by the kernel. Supported filesystems are
    btrfs and ext4 (discontinued) as well as snapshots of LVM logical volumes with
    thin-provisioning. Some filesystems might not be supported depending on your
    installation.</p>
      </div>
      <div class="refsect1">
        <a id="concepts"></a>
        <h2>CONCEPTS</h2>
        <div class="refsect2">
          <a id="configurations"></a>
          <h3>Configurations</h3>
          <p>For each filesystem or subvolume that should be snapshotted by
      snapper, a configuration file is required, see
      <a class="citerefentry" href="snapper-configs.html"><span class="citerefentry"><span class="refentrytitle">snapper-configs</span>(5)</span></a>. The
      setup can be done with the create-config command.</p>
        </div>
        <div class="refsect2">
          <a id="snapshots"></a>
          <h3>Snapshots</h3>
          <p>Snapper distinguishes three types of snapshots.</p>
          <div class="glosslist">
            <dl>
              <dt>
                <span class="glossterm">pre</span>
              </dt>
              <dd class="glossdef">
                <p>Pre snapshots should always have a corresponding post
	    snapshot. The intention of pre/post snapshot pairs is to snapshot the
	    filesystem before and after a modification.</p>
              </dd>
              <dt>
                <span class="glossterm">post</span>
              </dt>
              <dd class="glossdef">
                <p>See pre type.</p>
              </dd>
              <dt>
                <span class="glossterm">single</span>
              </dt>
              <dd class="glossdef">
                <p>These snapshots have no special relationship to other snapshots.</p>
              </dd>
            </dl>
          </div>
          <p>Note that filesystem-wise all three types are the same.</p>
        </div>
        <div class="refsect2">
          <a id="snapshot_description_and_userdata"></a>
          <h3>Snapshot Description and Userdata</h3>
          <p>With each snapshot a description and some userdata can be associated. The
      description is a string. The userdata is a list of key-value pairs where the
      keys and values are strings.</p>
          <p>Do not use non-ASCII characters for the snapshot description, userdata or
      any other strings, unless you always use the UTF-8 character encoding.</p>
        </div>
        <div class="refsect2">
          <a id="automatic_snapshot_creation"></a>
          <h3>Automatic Snapshot Creation</h3>
          <p>Next to manual snapshot creation, snapshots are also created automatically.</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>A cronjob or systemd timer creates hourly snapshots, if TIMELINE_CREATE is enabled for a config.</p>
              </li>
              <li class="listitem">
                <p>Certain programs like YaST and zypper create pre/post
	  snapshot pairs when modifying the system.</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="refsect2">
          <a id="cleanup_algorithms"></a>
          <h3>Cleanup Algorithms</h3>
          <p>Snapper provides several algorithms to clean up old snapshots. The
      algorithms are executed in a daily cronjob or systemd timer. This can be configured in the
      corresponding configurations files along with parameters for every
      algorithm.</p>
          <div class="glosslist">
            <dl>
              <dt>
                <span class="glossterm">number</span>
              </dt>
              <dd class="glossdef">
                <p>Deletes old snapshots when a certain number of snapshots is
	    reached.</p>
              </dd>
              <dt>
                <span class="glossterm">timeline</span>
              </dt>
              <dd class="glossdef">
                <p>Deletes old snapshots but keeps a number of hourly, daily,
	    weekly, monthly and yearly snapshots.</p>
              </dd>
              <dt>
                <span class="glossterm">empty-pre-post</span>
              </dt>
              <dd class="glossdef">
                <p>Deletes pre/post snapshot pairs with empty diffs.</p>
              </dd>
            </dl>
          </div>
          <p>The number and timeline cleanup algorithms can also try to
      keep the space used by snapshots below a limit and the free space of
      the filesystem above a limit. For the first condition quota must be
      setup, see command setup-quota. Additional the NUMBER_LIMIT and
      TIMELINE_LIMIT variables in the config file must have ranges (min- and
      max-value). The algorithms will then make two passes:

      </p>
          <div class="orderedlist">
            <ol class="orderedlist" type="1">
              <li class="listitem">
                <p>Delete snapshots above the max-value independent of
	  the snapshot and filesystem space.</p>
              </li>
              <li class="listitem">
                <p>Delete snapshots above the min-value until the limits for
	  the snapshot and filesystem are reached.</p>
              </li>
            </ol>
          </div>
          <p>

      The limit for the used space can be configured via the
      SPACE_LIMIT variable. Note: Only snapshots that have a cleanup
      algorithm set are taken into account when calculating the space
      used by snapshots.

      The limit for the free space can be configured via the
      FREE_LIMIT variable.

      </p>
        </div>
        <div class="refsect2">
          <a id="filters"></a>
          <h3>Filters</h3>
          <p>Some files keep state information of the system,
      e.g. <code class="filename">/etc/mtab</code>. Such files should never be
      reverted. To help users, snapper allows one to ignore these files.</p>
          <p>Filters are read from the files
      <code class="filename">/etc/snapper/filters/*.txt</code> and
      <code class="filename">/usr/share/snapper/filters/*.txt</code>, where
      for files with the same name the former location has precedence.
      Each line in those files specifies a pattern. When snapper
      computes the difference between two snapshots it ignores all
      files and directories matching any of those patterns by using
      <span class="citerefentry"><span class="refentrytitle">fnmatch</span>(3)</span>
      with the flag FNM_LEADING_DIR.</p>
          <p>Note that filters do not exclude files or directories from being
      snapshotted. For that, use subvolumes or mount points.</p>
        </div>
      </div>
      <div class="refsect1">
        <a id="global_options"></a>
        <h2>GLOBAL OPTIONS</h2>
        <div class="variablelist">
          <dl class="variablelist">
            <dt>
              <span class="term">
                <code class="option">-q, --quiet</code>
              </span>
            </dt>
            <dd>
              <p>Suppress normal output. Error messages will still be printed, though.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">-v, --verbose</code>
              </span>
            </dt>
            <dd>
              <p>Increase verbosity.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--debug</code>
              </span>
            </dt>
            <dd>
              <p>Turn on debugging.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--utc</code>
              </span>
            </dt>
            <dd>
              <p>Display dates and times in UTC. By default, local time is used.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--iso</code>
              </span>
            </dt>
            <dd>
              <p>Display dates and times in ISO format. ISO format is always used for machine-readable
	  outputs.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">-t, --table-style <em class="replaceable"><code>style</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Specifies table style. Table style is identified by an integer number.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--abbreviate</code>
              </span>
            </dt>
            <dd>
              <p>Try to abbreviate texts in some columns so that tables fit the width of the screen.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--machine-readable <em class="replaceable"><code>format</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Specifies a machine-readable output format. Possible options are csv and json.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--csvout</code>
              </span>
            </dt>
            <dd>
              <p>Sets CSV output format. See
	  <a class="link" href="https://tools.ietf.org/html/rfc4180" target="_top">RFC 4180</a>
	  for the details, except lines end with a LF, not CR+LF.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--jsonout</code>
              </span>
            </dt>
            <dd>
              <p>Sets JSON output format.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--separator <em class="replaceable"><code>character</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Specifies the character separator for CSV output format.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--no-headers</code>
              </span>
            </dt>
            <dd>
              <p>Suppress headers for CSV output format.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">-c, --config <em class="replaceable"><code>name</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Use specified configuration instead of the default configuration. The default
	  configuration is named "root".</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--no-dbus</code>
              </span>
            </dt>
            <dd>
              <p>Operate without a DBus connection.</p>
              <p>Use with caution since a running snapperd will not know about
	  modifications made to the system.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">-r, --root <em class="replaceable"><code>path</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Operate on target root. Only works together with no-dbus and only for some commands.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">-a, --ambit <em class="replaceable"><code>ambit</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Operate in the specified ambit. Can be used to override the ambit detection.
	  Allowed ambits are auto, classic and transactional.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">--version</code>
              </span>
            </dt>
            <dd>
              <p>Print version and exit.</p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect1">
        <a id="commands"></a>
        <h2>COMMANDS</h2>
        <p>Snapper provides a number of <span class="emphasis"><em>commands</em></span>. Each
    command accepts the options listed in the <a class="link" href="#global_options" title="GLOBAL OPTIONS">GLOBAL OPTIONS</a> section. These options must
    be specified <span class="emphasis"><em>before</em></span> the command name. In addition,
    many commands have specific options, which are listed in this
    section. These command-specific options must be specified
    <span class="emphasis"><em>after</em></span> the name of the command and
    <span class="emphasis"><em>before</em></span> any of the command arguments.</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt>
              <span class="term">
                <code class="option">help</code>
              </span>
            </dt>
            <dd>
              <p>Show short help text.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">list-configs [options]</code>
              </span>
            </dt>
            <dd>
              <p>List available configurations.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">--columns</code> <em class="replaceable"><code>columns</code></em></span>
                  </dt>
                  <dd>
                    <p>Select columns to show separated by comma.</p>
                    <p>Possible columns are: config, subvolume.</p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term">
                <code class="option">create-config [options] <em class="replaceable"><code>subvolume</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Create a new configuration for a filesystem or subvolume. For this command you
	  will likely need the global option <code class="option">--config</code>, see
	  <a class="link" href="#global_options" title="GLOBAL OPTIONS">GLOBAL OPTIONS</a> and
	  <a class="link" href="#concepts" title="CONCEPTS">CONCEPTS.</a></p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">-f, --fstype</code> <em class="replaceable"><code>fstype</code></em></span>
                  </dt>
                  <dd>
                    <p>Manually set filesystem type. Supported values are btrfs, ext4
		(discontinued) and lvm. For lvm, snapper uses LVM thin-provisioned snapshots.
		The filesystem type on top of LVM must be provided in parentheses,
		e.g. lvm(xfs).</p>
                    <p>Without this option snapper tries to detect the filesystem.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-t, --template</code> <em class="replaceable"><code>name</code></em></span>
                  </dt>
                  <dd>
                    <p>Name of template for the new configuration file.</p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term">
                <code class="option">delete-config</code>
              </span>
            </dt>
            <dd>
              <p>Delete a configuration for a filesystem or subvolume. For this
	  command you will likely need to global option
	  <code class="option">--config</code>, see <a class="link" href="#global_options" title="GLOBAL OPTIONS">GLOBAL
	  OPTIONS</a> and <a class="link" href="#concepts" title="CONCEPTS">CONCEPTS.</a></p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">get-config [options]</code>
              </span>
            </dt>
            <dd>
              <p>Displays the settings of the configuration.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">--columns</code> <em class="replaceable"><code>columns</code></em></span>
                  </dt>
                  <dd>
                    <p>Select columns to show separated by comma.</p>
                    <p>Possible columns are: key, value.</p>
                    <p>Columns are not selected when JSON format is used.</p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term"><code class="option">set-config</code> <em class="replaceable"><code>configdata</code></em></span>
            </dt>
            <dd>
              <p>Changes the settings of the configuration. The settings
	  <em class="replaceable"><code>configdata</code></em> are a list of key-value-pairs separated
	  by spaces and the key and value must be separated by an equal sign,
	  e.g. "NUMBER_CLEANUP=yes NUMBER_LIMIT=10". The value of SUBVOLUME and FSTYPE
	  cannot be changed.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">list (ls) [options]</code>
              </span>
            </dt>
            <dd>
              <p>List snapshots.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">-t, --type</code> <em class="replaceable"><code>type</code></em></span>
                  </dt>
                  <dd>
                    <p>Selects type of snapshots to list. Possible values are
		all, single and pre-post.</p>
                  </dd>
                  <dt>
                    <span class="term">
                      <code class="option">--disable-used-space</code>
                    </span>
                  </dt>
                  <dd>
                    <p>Disable display of used space.</p>
                    <p>Calculating the used space needs some time. Thus
		this option can speedup the listing.</p>
                  </dd>
                  <dt>
                    <span class="term">
                      <code class="option">-a, --all-configs</code>
                    </span>
                  </dt>
                  <dd>
                    <p>List snapshots from all configs accessible by the user.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">--columns</code> <em class="replaceable"><code>columns</code></em></span>
                  </dt>
                  <dd>
                    <p>Select columns to show separated by comma.</p>
                    <p>Possible columns are: config, subvolume, number, default, active,
		date, user, used-space, cleanup, description, userdata, pre-number, post-number,
		post-date, read-only.</p>
                  </dd>
                </dl>
              </div>
              <p>For each snapshot the output consists of several
	  columns. Some need explanation:</p>
              <div class="glosslist">
                <dl>
                  <dt>
                    <span class="glossterm">#, Pre # and Post #</span>
                  </dt>
                  <dd class="glossdef">
                    <p>The number of the snapshot.</p>
                    <p>For btrfs the number can be followed by a sign.
		A "<code class="computeroutput">-</code>" indicates that the snapshot is
		the currently mounted snapshot and a
		"<code class="computeroutput">+</code>" indicates that the snapshot will
		be mounted next time (It is the btrfs default subvolume). If both
		conditions apply a
		"<code class="computeroutput">*</code>" is displayed.</p>
                  </dd>
                  <dt>
                    <span class="glossterm">Used Space</span>
                  </dt>
                  <dd class="glossdef">
                    <p>For btrfs the exclusive space of the btrfs quota
		group corresponding to the snapshot.</p>
                    <p>Display of used space is automatically disabled
		if not available, e.g. quota not enabled on btrfs.</p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term">
                <code class="option">create [options]</code>
              </span>
            </dt>
            <dd>
              <p>Create a new snapshot.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">-t, --type</code> <em class="replaceable"><code>type</code></em></span>
                  </dt>
                  <dd>
                    <p>Specifies the type of the new snapshot. Possible values
		are single, pre and post.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">--pre-number</code> <em class="replaceable"><code>number</code></em></span>
                  </dt>
                  <dd>
                    <p>For post snapshots the number of the pre snapshot must
		be provided.</p>
                  </dd>
                  <dt>
                    <span class="term">
                      <code class="option">-p, --print-number</code>
                    </span>
                  </dt>
                  <dd>
                    <p>Print number of the created snapshot.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-d, --description</code> <em class="replaceable"><code>description</code></em></span>
                  </dt>
                  <dd>
                    <p>Description for the snapshot.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-c, --cleanup-algorithm</code> <em class="replaceable"><code>cleanup-algorithm</code></em></span>
                  </dt>
                  <dd>
                    <p>Set the cleanup algorithm for the snapshot.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-u, --userdata</code> <em class="replaceable"><code>userdata</code></em></span>
                  </dt>
                  <dd>
                    <p>Set userdata for the snapshot. The key-value pairs must
		be separated by comma and the key and value must be separated
		by an equal sign, e.g. requestid=42,user=arthur.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">--command</code> <em class="replaceable"><code>command</code></em></span>
                  </dt>
                  <dd>
                    <p>Create a pre and post snapshot and run command in between.</p>
                  </dd>
                  <dt>
                    <span class="term">
                      <code class="option">--read-only</code>
                    </span>
                  </dt>
                  <dd>
                    <p>Create a read-only snapshot. This is the default.</p>
                  </dd>
                  <dt>
                    <span class="term">
                      <code class="option">--read-write</code>
                    </span>
                  </dt>
                  <dd>
                    <p>Create a read-write snapshot.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">--from</code> <em class="replaceable"><code>number</code></em></span>
                  </dt>
                  <dd>
                    <p>Create a snapshot from the snapshot with the
		provided number instead of snapshot 0.</p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term">
                <code class="option">modify [options] <em class="replaceable"><code>number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Modify a snapshot.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">-d, --description</code> <em class="replaceable"><code>description</code></em></span>
                  </dt>
                  <dd>
                    <p>New description for snapshot.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-c, --cleanup-algorithm</code> <em class="replaceable"><code>cleanup-algorithm</code></em></span>
                  </dt>
                  <dd>
                    <p>Set the cleanup algorithm for the snapshot.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-u, --userdata</code> <em class="replaceable"><code>userdata</code></em></span>
                  </dt>
                  <dd>
                    <p>Set userdata for the snapshot. The key-value pairs must
		be separated by comma and the key and value must be separated
		by an equal sign, e.g. requestid=42,user=arthur.</p>
                  </dd>
                  <dt>
                    <span class="term">
                      <code class="option">--read-only</code>
                    </span>
                  </dt>
                  <dd>
                    <p>Set the snapshot read-only.</p>
                  </dd>
                  <dt>
                    <span class="term">
                      <code class="option">--read-write</code>
                    </span>
                  </dt>
                  <dd>
                    <p>Set the snapshot read-write.</p>
                  </dd>
                  <dt>
                    <span class="term">
                      <code class="option">--default</code>
                    </span>
                  </dt>
                  <dd>
                    <p>Set the snapshot as default snapshot. Only for btrfs.</p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term">
                <code class="option">delete (remove|rm) <em class="replaceable"><code>number</code></em> |
	<em class="replaceable"><code>number1-number2</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Delete a snapshot or a range of snapshots.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term">
                      <code class="option">-s, --sync</code>
                    </span>
                  </dt>
                  <dd>
                    <p>Sync the filesystem after deleting the snapshots. The
		details depend on the filesystem type.</p>
                    <p>Btrfs normally asynchronously frees space after deleting
		snapshots. With this option snapper will wait until the space once used by the
		deleted snapshots is actually available again.</p>
                  </dd>
                </dl>
              </div>
              <p>Snapshot 0 cannot be deleted. For btrfs the currently
	  mounted snapshot and the snapshot that will be mounted next time
	  (the btrfs default subvolume) can also not be deleted.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">mount <em class="replaceable"><code>number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Mount a snapshot. Not required for all filesystem types.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">umount <em class="replaceable"><code>number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Unmount a snapshot. Not required for all filesystem types.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">status [options] <em class="replaceable"><code>number1</code></em>..<em class="replaceable"><code>number2</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Compare the snapshots <em class="replaceable"><code>number1</code></em> and
	  <em class="replaceable"><code>number2</code></em>. This will show a list of files
	  and directories that have been created, modified or deleted in the
	  time between the two snapshots have been made.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">-o, --output</code> <em class="replaceable"><code>file</code></em></span>
                  </dt>
                  <dd>
                    <p>Write output to file <em class="replaceable"><code>file</code></em>.</p>
                  </dd>
                </dl>
              </div>
              <p>The output consists of a string encoding the status followed by
	  the filename. The characters of the status string are:</p>
              <div class="orderedlist">
                <ol class="orderedlist" type="1">
                  <li class="listitem">
                    <p>A "<code class="computeroutput">+</code>" means the file was
	      created, a "<code class="computeroutput">-</code>" means the file was deleted. A
	      "<code class="computeroutput">c</code>" means the content of the file has changed
	      and a "<code class="computeroutput">t</code>" means the type of the file has
	      changed (e.g. from regular file to directory).</p>
                  </li>
                  <li class="listitem">
                    <p>A "<code class="computeroutput">p</code>" means the permissions
	      are have changed.</p>
                  </li>
                  <li class="listitem">
                    <p>An "<code class="computeroutput">u</code>" means the user
	      ownership has changed.</p>
                  </li>
                  <li class="listitem">
                    <p>A "<code class="computeroutput">g</code>" means the group
	      ownership has changed.</p>
                  </li>
                  <li class="listitem">
                    <p>A "<code class="computeroutput">x</code>" means the extended
	      attribute information has changed.</p>
                  </li>
                  <li class="listitem">
                    <p>An "<code class="computeroutput">a</code>" means the ACL
	      information has changed.</p>
                  </li>
                </ol>
              </div>
              <p>If there is no change a "." is outputted.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">diff [options] <em class="replaceable"><code>number1</code></em>..<em class="replaceable"><code>number2</code></em> [files]</code>
              </span>
            </dt>
            <dd>
              <p>Compare the snapshots <em class="replaceable"><code>number1</code></em> and
	  <em class="replaceable"><code>number2</code></em>. This will show a diff of the
	  content of files and directories that have been created, modified or
	  deleted in the time between the two snapshots have been made.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">-i, --input</code> <em class="replaceable"><code>file</code></em></span>
                  </dt>
                  <dd>
                    <p>Read files to diff from file <em class="replaceable"><code>file</code></em>.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">--diff-cmd</code> <em class="replaceable"><code>command</code></em></span>
                  </dt>
                  <dd>
                    <p>Command used for comparing files. The default is
		<code class="filename">/usr/bin/diff --new-file --unified</code>. The two files to
		compare are passed as parameters to the command.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-x, --extensions</code> <em class="replaceable"><code>options</code></em></span>
                  </dt>
                  <dd>
                    <p>Extra options passed to the diff command.</p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term">
                <code class="option">undochange [options] <em class="replaceable"><code>number1</code></em>..<em class="replaceable"><code>number2</code></em> [files]</code>
              </span>
            </dt>
            <dd>
              <p>Undo changes done between snapshot <em class="replaceable"><code>number1</code></em> and <em class="replaceable"><code>number2</code></em>.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">-i, --input</code> <em class="replaceable"><code>file</code></em></span>
                  </dt>
                  <dd>
                    <p>Read files for which to undo changes from file <em class="replaceable"><code>file</code></em>.</p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term">
                <code class="option">rollback [options] [<em class="replaceable"><code>number</code></em>]</code>
              </span>
            </dt>
            <dd>
              <p>Creates two new snapshots and sets the default subvolume. Per
	  default the system boots from the default subvolume of the root filesystem.
	  The exact actions depend on whether a number is provided or not:</p>
              <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; ">
                  <li class="listitem">
                    <p>Without a number, a first read-only snapshot of the
	      default subvolume is created. A second read-write snapshot of the current
	      system is created. The system is set to boot from the second snapshot.</p>
                  </li>
                  <li class="listitem">
                    <p>With a number, a first read-only snapshot of the current
	      system is created. A second read-write snapshot is created of
	      <em class="replaceable"><code>number</code></em>. The system is set to boot from the second
	      snapshot.</p>
                  </li>
                </ul>
              </div>
              <p>Rollback is only supported with btrfs and requires a properly
	  configured system.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term">
                      <code class="option">-p, --print-number</code>
                    </span>
                  </dt>
                  <dd>
                    <p>Print number of the second created snapshot.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-d, --description</code> <em class="replaceable"><code>description</code></em></span>
                  </dt>
                  <dd>
                    <p>Description for the snapshot.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-c, --cleanup-algorithm</code> <em class="replaceable"><code>cleanup-algorithm</code></em></span>
                  </dt>
                  <dd>
                    <p>Set the cleanup algorithm for the snapshot.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">-u, --userdata</code> <em class="replaceable"><code>userdata</code></em></span>
                  </dt>
                  <dd>
                    <p>Set userdata for the snapshot. The key-value pairs must
		be separated by comma and the key and value must be separated
		by an equal sign, e.g. requestid=42,user=arthur.</p>
                  </dd>
                </dl>
              </div>
              <p>The rollback command also sets the description, the cleanup
	  algorithm and some userdata unless the values are specified on the command
	  line. This will automate cleanup of snapshots created by rollbacks.</p>
              <p>In other ambits than classic the rollback command does what is required
	  to do a rollback. Anyway it is recommended to use specific programs in that
	  case.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">setup-quota</code>
              </span>
            </dt>
            <dd>
              <p>Sets up quota. Currently only supported with btrfs.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">cleanup [options] <em class="replaceable"><code>cleanup-algorithm</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Run the cleanup algorithm
	  <em class="replaceable"><code>cleanup-algorithm</code></em>. Currently implemented cleanup algorithms
	  are number, timeline and empty-pre-post. To run all cleanup algorithms, all can be
	  provided as cleanup-algorithm.</p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term"><code class="option">--path</code> <em class="replaceable"><code>path</code></em></span>
                  </dt>
                  <dd>
                    <p>Cleanup all configs affecting path. Only useful for btrfs.</p>
                  </dd>
                  <dt>
                    <span class="term"><code class="option">--free-space</code> <em class="replaceable"><code>free-space</code></em></span>
                  </dt>
                  <dd>
                    <p>Try to make free-space available. Only useful for btrfs.</p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term">
                <code class="option">xadiff <em class="replaceable"><code>number1</code></em>..<em class="replaceable"><code>number2</code></em> [files]</code>
              </span>
            </dt>
            <dd>
              <p>Compare the extended attributes between snapshot
	  <em class="replaceable"><code>number1</code></em> and
	  <em class="replaceable"><code>number2</code></em>. See examples below:</p>
              <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; ">
                  <li class="listitem">
                    <p><code class="computeroutput"> +:user.foo</code> for created attributes</p>
                  </li>
                  <li class="listitem">
                    <p><code class="computeroutput"> -:user.bar</code> for removed attributes</p>
                  </li>
                  <li class="listitem">
                    <p><code class="computeroutput">-+:security.selinux</code> for modified attributes</p>
                  </li>
                </ul>
              </div>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect1">
        <a id="permissions"></a>
        <h2>PERMISSIONS</h2>
        <p>Non-root users can be allowed to use a configuration by setting
    ALLOW_USERS or ALLOW_GROUPS in the config file. For all operations to work, the
    user must also be able to read and access the <code class="filename">.snapshots</code>
    directory inside the subvolume. The <code class="filename">.snapshots</code> directory
    must be owned by root and must not be writable by anybody else.</p>
        <p>Here are some methods how to achieve that:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem">
              <p>Make the directory accessible for everyone:</p>
              <p>
                <span class="command">
                  <strong>chmod a+rx .snapshots</strong>
                </span>
              </p>
            </li>
            <li class="listitem">
              <p>Make the directory accessible for a group the user belongs to, e.g.:</p>
              <p>
                <span class="command">
                  <strong>chown :users .snapshots</strong>
                </span>
              </p>
            </li>
            <li class="listitem">
              <p>Make the directory accessible for the user using ACLs, e.g.:</p>
              <p>
                <span class="command">
                  <strong>setfacl -m u:tux:rx .snapshots</strong>
                </span>
              </p>
            </li>
          </ul>
        </div>
        <p>The last method can be performed by snapper, see the SYNC_ACL setting in
    <a class="citerefentry" href="snapper-configs.html"><span class="citerefentry"><span class="refentrytitle">snapper-configs</span>(5)</span></a>.</p>
      </div>
      <div class="refsect1">
        <a id="plugins"></a>
        <h2>PLUGINS</h2>
        <p>snapper can execute external scripts after certain actions. Scripts
    have to be placed in <code class="filename">/usr/lib/snapper/plugins</code>.
    The name has to start with a digit, execution order is alphabetical.</p>
        <p>The first argument of a script is the action snapper executed. The
    following actions are defined:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt>
              <span class="term">
                <code class="option">create-config-pre <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed before a new config is created</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">create-config-post <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed after a new config was created</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">delete-config-pre <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed before a config is deleted</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">delete-config-post <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed after a config was deleted</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">create-snapshot-pre <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em> <em class="replaceable"><code>snapshot-number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed before a new snapshot is created</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">create-snapshot-post <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em> <em class="replaceable"><code>snapshot-number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed after a new snapshot was created</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">modify-snapshot-pre <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em> <em class="replaceable"><code>snapshot-number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed before a snapshot is modified</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">modify-snapshot-post <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em> <em class="replaceable"><code>snapshot-number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed after a snapshot was modified</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">delete-snapshot-pre <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em> <em class="replaceable"><code>snapshot-number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed before a snapshot is removed</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">delete-snapshot-post <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em> <em class="replaceable"><code>snapshot-number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed after a snapshot was removed</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">set-default-snapshot-pre <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em> <em class="replaceable"><code>snapshot-number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed before the default snapshot is changed</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">set-default-snapshot-post <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em> <em class="replaceable"><code>snapshot-number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed after the default snapshot was changed</p>
            </dd>
            <dt>
              <span class="term">
                <code class="option">rollback-post <em class="replaceable"><code>subvolume</code></em> <em class="replaceable"><code>fstype</code></em> <em class="replaceable"><code>old-snapshot-number</code></em> <em class="replaceable"><code>new-snapshot-number</code></em></code>
              </span>
            </dt>
            <dd>
              <p>Executed after a rollback was done</p>
            </dd>
          </dl>
        </div>
        <p>More actions and arguments can be added any time. Using snapper in
    the plugins is not allowed.</p>
        <p>It is undefined whether the plugins are called from the
    client (snapper) or server (snapperd).</p>
      </div>
      <div class="refsect1">
        <a id="files"></a>
        <h2>FILES</h2>
        <div class="variablelist">
          <dl class="variablelist">
            <dt>
              <span class="term">
                <code class="filename">/etc/sysconfig/snapper</code>
              </span>
            </dt>
            <dd>
              <p>Global configuration file.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="filename">/etc/snapper/configs</code>
              </span>
            </dt>
            <dd>
              <p>Directory containing configuration files.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="filename">/etc/snapper/config-templates</code>
              </span>
            </dt>
            <dd>
              <p>Directory containing configuration templates.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="filename">/usr/share/snapper/config-templates</code>
              </span>
            </dt>
            <dd>
              <p>Fallback directory containing configuration templates.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="filename">/etc/snapper/filters/*.txt</code>
              </span>
            </dt>
            <dd>
              <p>Filter files.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="filename">/usr/share/snapper/filters/*.txt</code>
              </span>
            </dt>
            <dd>
              <p>Fallback filter files.</p>
            </dd>
            <dt>
              <span class="term">
                <code class="filename">/var/log/snapper.log</code>
              </span>
            </dt>
            <dd>
              <p>Logfile. Please include this file in bug reports.</p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect1">
        <a id="notes"></a>
        <h2>NOTES</h2>
        <p>There is no mechanism to ensure consistency of the files while a
    snapshot it made. E.g. the files of a database can be inconsistent while
    the database is running.</p>
        <p>Consistency after undochange is not guaranteed. E.g. when the
    creation of a user is undone, there might still exist files from that
    user.</p>
        <p>Support for individual filesystems, rollback and extended attributes
    are compile-time options and may not be available.</p>
      </div>
      <div class="refsect1">
        <a id="homepage"></a>
        <h2>HOMEPAGE</h2>
        <p>
          <a class="ulink" href="http://snapper.io/" target="_top">http://snapper.io/</a>
        </p>
      </div>
      <div class="refsect1">
        <a id="authors"></a>
        <h2>AUTHORS</h2>
        <p>Arvin Schnell <code class="email">&lt;<a class="email" href="mailto:aschnell@suse.com">aschnell@suse.com</a>&gt;</code></p>
      </div>
      <div class="refsect1">
        <a id="see_also"></a>
        <h2>SEE ALSO</h2>
        <p>
      <a class="citerefentry" href="snapper-configs.html"><span class="citerefentry"><span class="refentrytitle">snapper-configs</span>(5)</span></a>,
      <a class="citerefentry" href="snapper-zypp-plugin.html"><span class="citerefentry"><span class="refentrytitle">snapper-zypp-plugin</span>(8)</span></a>,
      <a class="citerefentry" href="pam_snapper.html"><span class="citerefentry"><span class="refentrytitle">pam_snapper</span>(8)</span></a>,
      <span class="citerefentry"><span class="refentrytitle">btrfs</span>(8)</span>,
      <span class="citerefentry"><span class="refentrytitle">lvm</span>(8)</span>,
      <span class="citerefentry"><span class="refentrytitle">attr</span>(5)</span>,
      <span class="citerefentry"><span class="refentrytitle">acl</span>(5)</span>
    </p>
      </div>
    </div>
  </body>
</html>
